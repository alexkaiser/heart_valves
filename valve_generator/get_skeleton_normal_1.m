function skeleton = get_skeleton_normal_1()
% 
% hardcoded patient specific MV skeleton
% 

% Copyright (c) 2019, Alexander D. Kaiser
% All rights reserved.
% 
% Redistribution and use in source and binary forms, with or without
% modification, are permitted provided that the following conditions are met:
% 
% 1. Redistributions of source code must retain the above copyright notice, this
%    list of conditions and the following disclaimer.
% 
% 2. Redistributions in binary form must reproduce the above copyright notice,
%    this list of conditions and the following disclaimer in the documentation
%    and/or other materials provided with the distribution.
% 
% 3. Neither the name of the copyright holder nor the names of its
%    contributors may be used to endorse or promote products derived from
%    this software without specific prior written permission.
% 
% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
% AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
% IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
% DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
% FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
% DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
% SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
% CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
% OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
% OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

debug = true; 


% NB: points are in mm 
ring_pts_raw = 0.1 * [322.25 416.36 199 322.537 416.529 199 313.41 416.981 199  313.509 416.851 199 319.996 415.217 199 320.007 415.222 199  303.328 451.186 199 303.008 451.24 199 316.505 414.573 199  317.003 414.482 199 301.871 451.374 199 301.374 451.404 199  322.629 416.591 199 322.94 416.788 199 298.629 430.917 199  298.751 430.848 199 315.136 445.533 199 314.839 445.778 199  292.795 448.605 199 292.649 448.473 199 327.376 427.043 199  327.369 427.375 199 325.46 419.849 199 325.628 420.23 199  327.259 428.862 199 327.242 428.984 199 316.057 444.748 199  315.623 445.118 199 300.626 451.425 199 300.097 451.426 199  323.218 416.995 199 321.259 440.289 199 321.103 440.427 199  325.742 420.489 199 325.875 420.828 199 297.427 431.569 199  297.737 431.404 199 317.807 443.214 199 317.373 443.59 199  296.994 431.827 199 297.05 431.795 199 290.667 440.202 199  290.674 440.143 199 298.317 451.267 199 298.09 451.228 199  318.295 414.584 199 318.677 414.686 199 296.513 450.839 199  296.434 450.809 199 294.856 450.099 199 294.542 449.916 199  302.458 428.587 199 302.479 428.573 199 302.437 428.601 199  294.212 449.702 199 294.138 449.65 199 323.685 417.375 199  323.971 417.647 199 327.272 425.646 199 327.313 426.026 199  310.607 421.257 199 310.838 420.937 199 317.877 443.153 199  327.352 426.415 199 327.166 425.017 199 327.189 425.142 199  319.217 442.021 199 319.195 442.039 199 304.802 426.876 199  304.927 426.782 199 326.804 423.515 199 326.923 423.941 199  301.917 451.369 199 301.885 451.372 199 315.698 414.875 199  315.85 414.797 199 305.359 450.818 199 305.113 450.864 199  319.94 441.427 199 319.806 441.539 199 307.645 424.466 199  307.807 424.316 199 312.088 418.976 199 312.24 418.728 199  310.237 421.738 199 310.463 421.452 199 319.519 441.777 199  303.913 451.095 199 303.786 451.119 199 311.24 448.256 199  311.089 448.348 199 290.689 444.802 199 290.631 444.431 199  313.75 416.553 199 313.822 416.467 199 311.865 419.346 199  308.153 423.985 199 308.447 423.7 199 290.716 439.877 199  290.755 439.627 199 306.173 425.764 199 306.486 425.497 199  294.256 449.731 199 317.469 414.459 199 317.95 414.507 199  324.302 436.624 199 324.066 436.982 199 300.677 451.425 199  300.659 451.425 199 327.199 425.185 199 327.258 425.557 199  301.631 429.136 199 301.961 428.918 199 293.276 449.018 199  293.002 448.786 199 290.764 439.581 199 299.099 430.66 199  299.153 430.63 199 295.843 450.587 199 295.572 450.465 199  323.295 438.071 199 322.933 438.532 199 291.909 436.353 199  292.07 436.087 199 301.137 429.452 199 301.519 429.207 199  292.107 436.028 199 292.359 435.689 199 290.526 443.318 199  290.511 442.795 199 290.59 444.09 199 290.563 443.83 199  310.729 448.552 199 310.645 448.601 199 292.477 435.54 199  292.676 435.309 199 316.562 444.302 199 316.187 444.633 199  317.458 414.458 199 292.881 435.081 199 293.017 434.94 199  308.626 423.52 199 293.312 434.649 199 293.383 434.581 199  302.717 451.282 199 293.758 434.238 199 293.768 434.229 199  298.785 451.335 199 322.896 438.576 199 322.53 439.006 199  292.227 448.047 199 292.072 447.875 199 305.719 450.73 199  322.032 439.541 199 321.849 439.722 199 326.694 423.133 199  326.733 423.276 199 307.114 450.336 199 306.796 450.446 199  306.569 425.427 199 306.875 425.162 199 296.909 431.877 199  312.999 417.549 199 313.292 417.138 199 295.299 450.324 199  295.086 450.223 199 317.448 414.459 199 291.194 446.498 199  291.192 446.494 199 326.925 423.947 199 326.925 423.949 199  291.959 447.73 199 291.819 447.557 199 319.352 414.931 199  319.47 414.981 199 325.182 419.311 199 325.258 419.446 199  315.236 415.15 199 327.107 429.846 199 327.098 429.913 199  313.261 446.981 199 312.938 447.201 199 301.572 429.172 199  299.435 451.394 199 299.28 451.382 199 320.297 441.127 199  320.272 441.149 199 302.821 428.341 199 303.226 428.058 199  303.348 427.968 199 295.982 450.643 199 303.678 427.733 199  303.838 427.616 199 320.232 441.182 199 326.052 421.288 199  326.084 421.377 199 309.673 449.138 199 309.434 449.265 199  324.863 418.752 199 324.888 418.79 199 298.861 451.343 199  301.296 451.409 199 301.293 451.409 199 310.438 448.716 199  300.654 429.755 199 301.048 429.507 199 307.322 424.764 199  313.705 446.664 199 313.51 446.802 199 291.191 446.491 199  291.047 446.141 199 314.629 415.628 199 314.854 415.433 199  299.875 451.422 199 326.887 430.923 199 326.858 431.045 199  290.514 441.937 199 290.514 441.934 199 290.918 445.766 199  290.82 445.398 199 290.814 445.375 199 290.699 444.854 199  316.453 414.582 199 316.467 414.579 199 312.595 418.151 199  312.766 417.896 199 310.135 421.863 199 326.209 433.14 199  326.177 433.224 199 306.528 425.459 199 325.641 434.344 199  325.616 434.389 199 296.526 450.844 199 326.509 432.314 199  326.417 432.582 199 325.261 419.452 199 323.376 417.114 199  321.308 415.852 199 321.51 415.952 199 327.096 424.635 199  314.487 446.07 199 314.209 446.283 199 306.056 450.654 199  293.286 449.025 199 290.612 440.62 199 319.99 415.214 199  305.774 426.097 199 306.016 425.894 199 314.164 446.322 199  308.209 449.889 199 308.17 449.907 199 300.236 429.999 199  300.503 429.845 199 312.303 418.62 199 309.171 422.963 199  309.281 422.845 199 306.133 450.639 199 327.075 430.034 199  326.986 430.467 199 325.116 435.279 199 325.114 435.283 199  301.297 451.409 199 315.517 445.211 199 315.215 445.464 199  290.871 439.065 199 290.877 439.038 199 310.918 420.822 199  311.138 420.5 199 307.774 450.085 199 307.443 450.219 199  291.003 438.536 199 291.036 438.419 199 291.155 438.013 199  291.231 437.799 199 327.354 426.56 199 307.237 450.298 199  302.413 451.32 199 324 437.081 199 304.162 427.378 199  304.24 427.318 199 315.168 415.199 199 291.342 437.503 199  291.478 437.18 199 293.762 449.392 199 291.555 437.005 199  291.779 436.57 199 291.804 436.524 199 305.201 426.563 199  324.495 436.314 199 311.245 420.337 199 311.443 420.033 199  326.647 422.984 199 316.627 444.243 199 316.579 444.286 199  299.687 430.323 199 299.877 430.208 199 308.73 449.634 199  308.581 449.71 199 327.216 429.137 199 324.038 417.704 199  294.184 433.854 199 294.219 433.823 199 311.585 448.052 199  311.583 448.053 199 319.969 415.205 199 314.084 446.383 199  313.855 446.55 199 327.11 424.716 199 306.497 450.53 199  294.611 433.485 199 294.692 433.417 199 316.408 414.598 199  292.435 448.274 199 295.056 433.121 199 295.154 433.045 199  326.189 421.671 199 296.345 432.211 199 322.137 439.429 199  322.068 439.504 199 325.97 433.681 199 295.512 432.774 199  295.697 432.644 199 325.919 433.794 199 325.7 434.227 199  309.135 449.425 199 325.377 434.827 199 325.349 434.875 199  311.534 419.888 199 303.013 428.208 199 326.38 432.692 199  326.365 432.738 199 326.834 431.139 199 326.7 431.671 199  291.651 447.303 199 317.107 443.823 199 316.988 443.925 199  304.406 451.006 199 304.051 451.066 199 323.762 437.429 199  327.363 426.759 199 308.331 449.829 199 290.58 440.913 199  290.59 440.828 199 324.896 418.804 199 318.501 442.616 199  318.463 442.647 199 311.852 419.369 199 311.857 419.36 199  326.643 431.868 199 326.535 432.236 199 311.961 447.827 199  308.824 423.314 199 320.776 415.59 199 309.881 449.025 199  305.399 426.404 199 305.596 426.245 199 327.37 427.532 199  327.34 427.983 199 296.538 450.848 199 290.983 445.954 199  321.72 439.849 199 321.637 439.927 199 322.913 438.557 199  298.119 431.196 199 298.373 431.053 199 314.832 445.783 199  321.954 416.193 199 297.773 451.174 199 311.859 419.357 199  295.883 432.51 199 296.105 432.37 199 326.497 422.528 199  324.083 417.749 199 327.301 428.49 199 322.909 438.561 199  320.586 440.886 199 312.409 447.547 199 312.362 447.577 199  314.388 415.854 199 320.999 415.699 199 308.94 449.531 199  306.947 425.096 199 309.553 422.548 199 290.507 442.661 199  290.514 441.941 199 309.004 423.125 199 313.994 416.279 199  327.335 428.073 199 323.528 437.755 199 323.362 437.979 199  312.931 417.647 199 312.328 447.598 199 318.44 442.667 199  318.016 443.036 199 322.055 416.245 199 324.219 417.914 199  324.585 418.345 199 323.331 417.078 199 318.143 414.547 199  297.587 451.132 199 297.391 451.09 199 325.106 435.296 199  324.762 435.88 199 290.542 441.405 199 290.543 441.394 199  290.539 443.521 199 309.789 422.279 199 309.819 422.243 199  304.882 450.915 199 324.631 436.094 199 312.834 447.273 199  326.322 422.034 199 326.389 422.22 199 318.817 414.736 199  297.938 431.294 199 314.969 415.342 199 311.579 448.055 199  314.264 415.978 199 291.499 447.084 199 290.679 440.108 199  327.175 429.441 199 318.883 442.302 199 312.505 418.299 199  296.604 450.866 199 304.294 427.277 199 304.611 450.964 199  320.892 440.614 199 293.866 434.141 199 290.834 439.244 199  319.184 442.048 199]; 
ring_pts_raw = reshape(ring_pts_raw, 3, []); 

connectivity_raw = [2 0 1 
2 2 3 
2 4 5 
2 6 7 
2 8 9 
2 10 11 
2 12 13 
2 14 15 
2 16 17 
2 18 19 
2 20 21 
2 22 23 
2 24 25 
2 26 27 
2 28 29 
2 13 30 
2 1 12 
2 31 32 
2 33 34 
2 35 36 
2 37 38 
2 39 40 
2 41 42 
2 43 44 
2 45 46 
2 47 48 
2 49 50 
2 51 52 
2 53 51 
2 54 55 
2 56 57 
2 58 59 
2 60 61 
2 62 37 
2 59 63 
2 64 65 
2 66 67 
2 68 69 
2 70 71 
2 72 73 
2 74 75 
2 76 77 
2 78 79 
2 80 81 
2 82 83 
2 84 85 
2 79 86 
2 87 88 
2 89 90 
2 91 92 
2 93 94 
2 95 82 
2 96 97 
2 98 99 
2 100 101 
2 102 54 
2 103 104 
2 105 106 
2 107 108 
2 109 110 
2 111 112 
2 113 114 
2 99 115 
2 116 117 
2 118 119 
2 120 121 
2 122 123 
2 124 125 
2 126 127 
2 128 129 
2 130 131 
2 132 133 
2 134 135 
2 136 137 
2 138 103 
2 139 140 
2 97 141 
2 142 143 
2 7 144 
2 145 146 
2 147 43 
2 148 149 
2 150 151 
2 152 76 
2 153 154 
2 155 156 
2 157 158 
2 159 160 
2 161 39 
2 162 163 
2 164 165 
2 166 138 
2 167 168 
2 169 170 
2 171 172 
2 173 174 
2 175 176 
2 177 74 
2 178 179 
2 180 181 
2 125 182 
2 183 184 
2 185 186 
2 52 187 
2 188 189 
2 48 190 
2 191 192 
2 186 193 
2 194 195 
2 196 197 
2 198 199 
2 184 200 
2 201 202 
2 133 203 
2 204 205 
2 206 80 
2 207 208 
2 209 210 
2 211 212 
2 29 213 
2 214 215 
2 202 107 
2 163 2 
2 216 217 
2 218 219 
2 220 221 
2 222 223 
2 224 225 
2 156 70 
2 71 169 
2 226 84 
2 227 228 
2 229 159 
2 230 231 
2 232 47 
2 233 234 
2 235 22 
2 236 56 
2 237 238 
2 170 239 
2 240 241 
2 108 28 
2 242 152 
2 243 113 
2 244 41 
2 245 4 
2 246 247 
2 241 248 
2 249 250 
2 251 252 
2 83 253 
2 254 255 
2 256 242 
2 252 204 
2 257 258 
2 259 260 
2 261 201 
2 262 263 
2 264 265 
2 266 267 
2 258 214 
2 268 269 
2 270 271 
2 272 273 
2 27 262 
2 34 194 
2 63 274 
2 275 157 
2 144 276 
2 106 277 
2 278 279 
2 280 177 
2 281 282 
2 55 283 
2 284 285 
2 247 100 
2 286 122 
2 69 287 
2 288 105 
2 289 290 
2 291 155 
2 292 293 
2 294 295 
2 296 297 
2 25 298 
2 57 299 
2 300 301 
2 302 303 
2 304 245 
2 305 306 
2 73 10 
2 307 64 
2 151 171 
2 308 256 
2 309 310 
2 311 222 
2 19 312 
2 313 314 
2 189 191 
2 101 229 
2 195 315 
2 316 161 
2 317 318 
2 228 319 
2 320 321 
2 322 323 
2 174 304 
2 197 324 
2 325 326 
2 290 327 
2 213 183 
2 248 305 
2 50 102 
2 165 49 
2 312 150 
2 239 307 
2 187 328 
2 92 130 
2 329 330 
2 331 332 
2 9 166 
2 15 116 
2 172 333 
2 334 335 
2 336 337 
2 3 93 
2 277 338 
2 339 20 
2 340 249 
2 341 342 
2 199 343 
2 117 294 
2 344 345 
2 176 235 
2 346 347 
2 348 349 
2 350 302 
2 141 351 
2 5 352 
2 90 132 
2 203 353 
2 354 355 
2 356 357 
2 358 232 
2 192 278 
2 210 359 
2 360 361 
2 327 346 
2 179 257 
2 223 8 
2 121 362 
2 363 364 
2 365 240 
2 23 33 
2 17 365 
2 238 366 
2 44 367 
2 368 95 
2 369 370 
2 355 246 
2 371 291 
2 112 53 
2 299 372 
2 373 24 
2 374 148 
2 375 185 
2 85 60 
2 376 377 
2 378 211 
2 352 379 
2 231 325 
2 276 72 
2 114 18 
2 380 296 
2 193 78 
2 324 380 
2 381 206 
2 38 334 
2 255 382 
2 383 384 
2 349 233 
2 385 254 
2 353 196 
2 370 316 
2 94 386 
2 387 373 
2 306 207 
2 182 111 
2 388 389 
2 225 390 
2 391 350 
2 392 393 
2 394 0 
2 190 118 
2 395 396 
2 30 397 
2 104 398 
2 399 400 
2 283 243 
2 390 162 
2 129 383 
2 149 317 
2 401 402 
2 217 403 
2 404 341 
2 405 128 
2 267 289 
2 359 218 
2 406 407 
2 40 35 
2 389 120 
2 347 368 
2 367 399 
2 293 136 
2 77 408 
2 351 385 
2 402 409 
2 61 266 
2 410 376 
2 398 45 
2 411 412 
2 215 331 
2 335 292 
2 362 374 
2 46 413 
2 409 288 
2 36 414 
2 260 401 
2 415 280 
2 205 124 
2 303 416 
2 168 209 
2 345 392 
2 21 356 
2 417 378 
2 208 180 
2 333 418 
2 414 363 
2 379 237 
2 42 419 
2 263 16 
2 330 227 
2 343 175 
2 298 420 
2 297 340 
2 137 26 
2 332 348 
2 328 188 
2 382 406 
2 337 87 
2 75 311 
2 421 344 
2 181 410 
2 422 224 
2 377 391 
2 88 6 
2 384 216 
2 131 405 
2 119 164 
2 407 226 
2 423 358 
2 212 415 
2 416 89 
2 357 387 
2 400 423 
2 160 381 
2 424 68 
2 295 251 
2 408 425 
2 32 426 
2 11 261 
2 200 147 
2 314 320 
2 310 313 
2 301 309 
2 427 300 
2 146 427 
2 143 145 
2 140 142 
2 135 139 
2 127 134 
2 123 126 
2 285 286 
2 282 284 
2 273 281 
2 271 272 
2 265 270 
2 428 264 
2 419 98 
2 342 244 
2 274 339 
2 279 424 
2 115 428 
2 221 91 
2 219 220 
2 287 354 
2 420 178 
2 412 371 
2 366 394 
2 319 322 
2 234 329 
2 372 395 
2 413 173 
2 269 275 
2 250 268 
2 393 62 
2 67 429 
2 361 31 
2 323 230 
2 429 421 
2 318 153 
2 364 14 
2 315 411 
2 397 236 
2 253 422 
2 386 417 
2 81 96 
2 65 109 
2 396 198 
2 425 336 
2 154 360 
2 418 167 
2 338 388 
2 403 404 
2 321 369 
2 326 259 
2 426 375 
2 110 58 
2 86 66 
2 158 308 ];

first_idx  = connectivity_raw(:,2); 
second_idx = connectivity_raw(:,3); 

valve_ring_pts = zeros(3,length(first_idx)); 
pt_idx = 0; 

current = first_idx(1); 
next = second_idx(1); 
complete = false; 
while true
    
    % add one to value of current when using as matlab index
    pt_idx = pt_idx + 1;
    valve_ring_pts(:,pt_idx) = ring_pts_raw(:, current + 1); 
    
    % search for the next index 
    current = first_idx(find(first_idx == next)); 
    next    = second_idx(find(first_idx == next)); 
    
    if isempty(current)
        error('Did not find a vertex with the correct index'); 
    end 
    
    % periodic return to the first point 
    if current == first_idx(1)
        complete = true; 
        break;
    end 
    
end 

if ~complete
    error('failed to find periodic cycle')
end 

skeleton.valve_ring_pts = valve_ring_pts; 

skeleton.n_ring_pts = size(skeleton.valve_ring_pts,2); 

if skeleton.n_ring_pts ~= pt_idx
    error('inconsistency in lengths')
end 

skeleton.ring_center = mean(skeleton.valve_ring_pts')'; 

radii = zeros(skeleton.n_ring_pts, 1); 
for j=1:skeleton.n_ring_pts
    radii(j) = norm(skeleton.valve_ring_pts(:,j) - skeleton.ring_center); 
end

skeleton.r = mean(radii); 


papillary_raw = 0.1 * [302.399 451.766 171.229 303.986 454.417 171.358 330.227 425.409 171.363 302.453 453.726 171.571 331.228 425.822 171.459 302.977 451.799 171.248 331.841 427.276 171.097 329.672 425.798 171.159]; 
skeleton.papillary = reshape(papillary_raw, [3 8]); 
indices = [5 7 2 4 6 1 3 0] + 1; 

skeleton.papillary = skeleton.papillary(:,indices); 

skeleton.ring_offset_angle = pi/4

if debug 
    fig = figure; 
    
    x = squeeze(skeleton.valve_ring_pts(1,:));
    y = squeeze(skeleton.valve_ring_pts(2,:));
    z = squeeze(skeleton.valve_ring_pts(3,:));
    plot3(x,y,z); 
    
    title('valve ring hcm d')
end 





